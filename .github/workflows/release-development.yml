# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Release development

on:
  push:
    branches: [ "main" ]

jobs:

  pre-release:
    name: "Pre Release"
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3

    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.19
        
    - name: Install dependencies
      run: go get .

    - name: Install libraries
      run: sudo apt-get install -y brotli zopfli

    - name: Build
      run: |
        bash ./scripts/build.sh  
        bash ./scripts/build-wasm.sh main build zopfli brotli  
        bash ./scripts/build-wasm.sh helper build zopfli brotli  
        bash ./scripts/build-electron-helper.sh     
        cd ./bin
        zip -r artifact-wasm.zip wasm
        zip -r artifact-electron-helper.zip electron-helper
      
    - uses: "marvinpinto/action-automatic-releases@latest"
      with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "development"
          prerelease: true
          title: "Development Build"
          files: |
            ./bin/pandora-linux-amd64
            ./bin/pandora-linux-386
            ./bin/pandora-linux-arm64
            ./bin/pandora-linux-armv7l
            ./bin/pandora-windows-amd64.exe
            ./bin/pandora-windows-386.exe
            ./bin/pandora-windows-arm64.exe
            ./bin/pandora-darwin-amd64
            ./bin/pandora-darwin-arm64
            ./bin/artifact-wasm.zip
            ./bin/artifact-electron-helper.zip
